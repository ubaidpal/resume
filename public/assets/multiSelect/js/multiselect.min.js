function Multiselect(a){if("undefined"!=typeof $&&!$(a).is("select")||"undefined"==typeof $&&"SELECT"!=a.tagName)throw"Multiselect: passed object must be a select";if("undefined"!=typeof $&&!$(a).attr("multiple")||"undefined"==typeof $&&!a.hasAttribute("multiple"))throw"Multiselect: passed object should contain 'multiple' attribute";"undefined"!=typeof $?this._item=a[0]:this._item=a,this._createUI(),this._appendEvents(),this._initSelectedFields()}function hideMultiselects(a){m_helper.each(window.multiselects,function(b){document.getElementById(b._getItemListIdentifier()).offsetParent&&!m_helper.parent(a.target,b._getIdentifier())&&b._hideList(b,a)})}if(!m_helper)var m_helper={removeNode:function(a){var b=document.getElementById(a);b&&b.parentNode.removeChild(b)},insertAfter:function(a,b){var c=b.parentNode;b.nextElementSibling?c.insertBefore(a,b.nextElementSibling):c.appendChild(a)},hide:function(a){a.style.display="none"},hideAll:function(a){for(var b=0;b<a.length;b++)this.hide(a[b])},show:function(a){a.style.display="block"},showAll:function(a){for(var b=0;b<a.length;b++)this.show(a[b])},parent:function(a,b){for(var c=a.parentElement;c&&"BODY"!=c.tagName;){if(c.id==b)return c;c=c.parentElement}return null},create:function(a){var b=document.createElement(a.tag);if(a.id&&(b.id=a.id),a.class&&(b.className=a.class),a.attributes)for(var c in a.attributes)b.setAttribute(c,a.attributes[c]);if(a.data)for(var c in a.data)b.dataset[c]=a.data[c];return b},div:function(a){return a||(a=new Object),a.tag="div",this.create(a)},label:function(a){return a||(a=new Object),a.tag="label",this.create(a)},textField:function(a){return a||(a=new Object),a.tag="input",a.attributes||(a.attributes=new Object),a.attributes.type="text",this.create(a)},checkbox:function(a){return a||(a=new Object),a.tag="input",a.attributes||(a.attributes=new Object),a.attributes.type="checkbox",this.create(a)},each:function(a,b){for(var c=0;c<a.length;c++)b(a[c])},setActive:function(a){a.classList.add("active")},setUnactive:function(a){a.classList.remove("active")},select:function(a){a.setAttribute("selected","selected")},deselect:function(a){a.removeAttribute("selected")},check:function(a){a.checked=!0},uncheck:function(a){a.checked=!1},click:function(a){if(a.fireEvent)el.fireEvent("onclick");else{var b=document.createEvent("Events");b.initEvent("click",!0,!1),a.dispatchEvent(b)}}};Multiselect.prototype={_createUI:function(){m_helper.removeNode(this._getIdentifier());var a=this._createWrapper();m_helper.insertAfter(a,this._item),a.appendChild(this._createInputField()),a.appendChild(this._createItemList()),m_helper.hide(this._item)},_createWrapper:function(){var a=document.createElement("div");return a.className="multiselect-wrapper",a.id=this._getIdentifier(),a},_createInputField:function(){var a=m_helper.textField({id:this._getInputFieldIdentifier(),class:"multiselect-input"}),b=m_helper.label({id:this._getInputBadgeIdentifier(),class:"multiselect-count",attributes:{for:this._getInputFieldIdentifier()}}),c=m_helper.label({class:"multiselect-dropdown-arrow",attributes:{for:this._getInputFieldIdentifier()}}),d=m_helper.div({class:"multiselect-input-div"});return b.style.visibility="hidden",b.innerHTML=0,d.appendChild(a),d.appendChild(b),d.appendChild(c),d},_createItemList:function(){var a=m_helper.create({tag:"ul"}),b=this;m_helper.each(this._getItems(this._item),function(c){var d=b._createItem("li",c.id,c.text,c.selected);a.appendChild(d);var e=d.querySelector("input[type=checkbox]");c.multiselectElement=e,e.dataset.multiselectElement=JSON.stringify(c)});var c=this._createItem("span",-1,"Select all"),d=m_helper.div({id:this._getItemListIdentifier(),class:"multiselect-list"});return d.appendChild(c),d.appendChild(m_helper.create({tag:"hr"})),d.appendChild(a),d},_createItem:function(a,b,c,d){var e=m_helper.checkbox({class:"multiselect-checkbox",data:{val:b}}),f=m_helper.create({tag:"span",class:"multiselect-text"}),g=m_helper.create({tag:a}),h=m_helper.label();return f.className="multiselect-text",f.innerHTML=c,h.appendChild(e),h.appendChild(f),g.appendChild(h),g},_initSelectedFields:function(){var a=this._getItems().filter(function(a){return a.selected});if(0!=a.length){var b=this;m_helper.each(a,function(a){b.select(a.id)})}else this.selectAll();this._hideList(this)},select:function(a){var b=this;a&&m_helper.each(document.getElementById(this._getIdentifier()).querySelectorAll(".multiselect-checkbox"),function(c){c.dataset.val==a&&(m_helper.check(c),b._onCheckBoxChange(c,b))})},selectAll:function(a){var b=document.querySelector("#"+this._getIdentifier()+" .multiselect-checkbox");m_helper.check(b),this._onCheckBoxChange(b,this)},_appendEvents:function(){var a=this;document.getElementById(a._getInputFieldIdentifier()).addEventListener("focus",function(b){a._showList(a),document.getElementById(a._getInputFieldIdentifier()).value="",m_helper.each(window.multiselects,function(c){document.getElementById(c._getItemListIdentifier()).offsetParent&&m_helper.parent(b.target,c._getIdentifier())&&c._hideList(a)})}),document.getElementById(a._getInputFieldIdentifier()).addEventListener("click",function(){a._showList(a),document.getElementById(a._getInputFieldIdentifier()).value=""}),document.getElementById(a._getIdentifier()).addEventListener("click",function(b){b=b||window.event;var c=b.target||b.srcElement;m_helper.parent(c,a._getIdentifier())&&b.stopPropagation()}),document.getElementById(a._getItemListIdentifier()).addEventListener("mouseover",function(){a._showList(a)}),m_helper.each(document.getElementById(a._getIdentifier()).querySelectorAll(".multiselect-checkbox"),function(b){b.addEventListener("change",function(c){a._onCheckBoxChange(b,a,c)})});var b=function(){var b=this.value.toLowerCase();if(b&&""!=b){m_helper.hide(document.querySelector("#"+a._getItemListIdentifier()+" > span")),m_helper.hide(document.querySelector("#"+a._getItemListIdentifier()+" > hr"));var c=Array.prototype.filter.call(document.querySelectorAll("#"+a._getItemListIdentifier()+" li span"),function(a){return a.innerHTML.toLowerCase().indexOf(b)>-1});m_helper.hideAll(document.querySelectorAll("#"+a._getItemListIdentifier()+" li")),m_helper.each(c,function(a){m_helper.show(a.parentElement.parentElement)})}else m_helper.show(document.querySelector("#"+a._getItemListIdentifier()+" > span")),m_helper.show(document.querySelector("#"+a._getItemListIdentifier()+" > hr")),m_helper.showAll(document.querySelectorAll("#"+a._getItemListIdentifier()+" li"))};document.getElementById(a._getInputFieldIdentifier()).addEventListener("propertychange",b),document.getElementById(a._getInputFieldIdentifier()).addEventListener("input",b)},_onCheckBoxChange:function(a,b,c){a.dataset.multiselectElement?(b._performSelectItem(a,b),b._updateSelectAll(b)):b._performSelectAll(a,b),b._forceUpdate()},_performSelectItem:function(a,b){var c=JSON.parse(a.dataset.multiselectElement);a.checked?(b._itemCounter++,m_helper.select(this._item.options[c.index]),m_helper.setActive(a.parentElement.parentElement)):(b._itemCounter--,m_helper.deselect(this._item.options[c.index]),m_helper.setUnactive(a.parentElement.parentElement))},_performSelectAll:function(a,b){var c=b._getItems();a.checked?(b._itemCounter=c.length,m_helper.each(c,function(a){m_helper.setActive(a.multiselectElement.parentElement.parentElement),m_helper.select(b._item.options[a.index]),m_helper.check(a.multiselectElement)})):(b._itemCounter=0,m_helper.each(c,function(a){a.multiselectElement.parentElement.parentElement.classList.remove("active"),b._item.options[a.index].removeAttribute("selected"),m_helper.uncheck(a.multiselectElement)}))},_updateSelectAll:function(a){var b=document.getElementById(a._getItemListIdentifier()).querySelector("input[type=checkbox]");a._itemCounter==a._getItems().length?b.checked=!0:b.checked&&(b.checked=!1)},_hideList:function(a,b){m_helper.setUnactive(document.getElementById(a._getItemListIdentifier())),m_helper.show(document.getElementById(a._getItemListIdentifier()).querySelector("span")),m_helper.show(document.getElementById(a._getItemListIdentifier()).querySelector("hr")),m_helper.showAll(document.getElementById(a._getItemListIdentifier()).querySelectorAll("li")),a._updateText(a),b&&b.stopPropagation()},_updateText:function(a){var b=document.getElementById(a._getItemListIdentifier()).querySelectorAll("ul .active");if(b.length>0){for(var c="",d=0;d<(b.length<5?b.length:5);d++)c+=b[d].innerText+", ";c=c.substr(0,c.length-2),c.length>20&&(c=c.substr(0,17)+"..."),b.length==document.getElementById(a._getItemListIdentifier()).querySelectorAll("ul li").length&&(c="All selected"),document.getElementById(a._getInputFieldIdentifier()).value=c}},_showList:function(a){m_helper.setActive(document.getElementById(a._getItemListIdentifier()))},_forceUpdate:function(){var a=document.getElementById(this._getInputBadgeIdentifier());if(a.style.visibility="hidden",0!=this._itemCounter){a.innerHTML=this._itemCounter,a.style.visibility="visible";var b=a.nextElementSibling;this._itemCounter<10?(a.style.left="-45px",b.style.marginLeft="-42px"):this._itemCounter<100?(a.style.left="-50px",b.style.marginLeft="-47px"):this._itemCounter<1e3?(a.style.left="-55px",b.style.marginLeft="-52px"):this._itemCounter<1e4&&(a.style.left="-60px",b.style.marginLeft="-57px")}},_items:void 0,_itemCounter:0,_getItems:function(){if(void 0==this._items){for(var a=[],b=this._item.options,c=0;c<b.length;c++){var d={id:b[c].value,index:c,text:b[c].innerHTML,selected:!!b[c].selected,selectElement:b[c]};a.push(d)}this._items=a}return this._items},_getItemUniqueIdentifier:function(){var a=this._item.getAttribute("id"),b=this._item.getAttribute("name");if(!a&&!b)throw"Multiselect: object does not contain any identifier (id or name)";return a?a:b},_getIdentifier:function(){return this._getItemUniqueIdentifier()+"_multiSelect"},_getInputFieldIdentifier:function(){return this._getItemUniqueIdentifier()+"_input"},_getItemListIdentifier:function(){return this._getItemUniqueIdentifier()+"_itemList"},_getInputBadgeIdentifier:function(){return this._getItemUniqueIdentifier()+"_inputCount"}},window.multiselects=[],"undefined"!=typeof $?($.fn.multiselect=function(){0!=this.length&&$(this).each(function(a,b){window.multiselects.push(new Multiselect($(b)))})},$(document).click(function(a){hideMultiselects(a)})):(document.multiselect=function(a){m_helper.each(document.querySelectorAll(a),function(a){window.multiselects.push(new Multiselect(a))})},window.onclick=function(a){hideMultiselects(a)});